
import React, { createContext, useContext, useState, useEffect } from "react";

type TranslationContextType = {
  t: (key: string) => string;
  changeLanguage: (lang: string) => void;
  currentLanguage: string;
  setLanguage: (lang: string) => void; // Add this missing property
};

interface TranslationMap {
  [key: string]: {
    [key: string]: string;
  };
}

const TranslationContext = createContext<TranslationContextType>({
  t: () => "",
  changeLanguage: () => {},
  currentLanguage: "en",
  setLanguage: () => {} // Initialize with empty function
});

// All of our translations
const translations: TranslationMap = {
  en: {
    signIn: "Sign In",
    signOut: "Sign Out",
    signUp: "Sign Up",
    email: "Email",
    password: "Password",
    confirmPassword: "Confirm Password",
    forgotPassword: "Forgot Password?",
    resetPassword: "Reset Password",
    sendResetLink: "Send Reset Link",
    register: "Register",
    login: "Log In",
    logout: "Log Out",
    whatToCallYou: "What should we call you?",
    yourName: "Your Name",
    welcomeBack: "Welcome Back",
    loginToContinue: "Log in to continue",
    createAccount: "Create Account",
    joinAWAaz: "Join AWAaz to help preserve indigenous languages",
    loggingIn: "Logging in...",
    creating: "Creating Account...",
    wrongCredentials: "Incorrect email or password",
    userExists: "User already exists with this email",
    welcome: "Welcome to AWAaz",
    record: "Record",
    translate: "Translate",
    archive: "Archive",
    settings: "Settings",
    about: "About",
    profile: "Profile",
    language: "Language",
    changeLanguage: "Change Language",
    english: "English",
    hindi: "Hindi",
    theme: "Theme",
    changeTheme: "Change Theme",
    light: "Light",
    dark: "Dark",
    system: "System",
    save: "Save",
    cancel: "Cancel",
    home: "Home",
    search: "Search",
    notifications: "Notifications",
    help: "Help",
    contact: "Contact",
    myRecordings: "My Recordings",
    allRecordings: "All Recordings",
    followedRecordings: "Followed Recordings",
    recentRecordings: "Recent Recordings",
    popularRecordings: "Popular Recordings",
    noRecordings: "No recordings found",
    loading: "Loading...",
    uploadRecording: "Upload Recording",
    recordAudio: "Record Audio",
    playback: "Playback",
    pause: "Pause",
    stop: "Stop",
    retry: "Retry",
    submit: "Submit",
    recordingDuration: "Recording Duration",
    recordingDate: "Recording Date",
    recordingLanguage: "Recording Language",
    recordingSpeaker: "Speaker",
    recordingRegion: "Region",
    recordingType: "Recording Type",
    word: "Phrase",
    story: "Story",
    song: "Song",
    originalLanguage: "Original Language",
    translateTo: "Translate To",
    comment: "Comment",
    comments: "Comments",
    addComment: "Add Comment",
    reply: "Reply",
    share: "Share",
    download: "Download",
    edit: "Edit",
    delete: "Delete",
    reportIssue: "Report Issue",
    noResults: "No results found",
    tryAgain: "Try Again",
    somethingWentWrong: "Something went wrong",
    pageNotFound: "Page Not Found",
    goBack: "Go Back",
    goToHomePage: "Go to Home Page",
    moreInfo: "More Info",
    lessInfo: "Less Info",
    openMenu: "Open Menu",
    closeMenu: "Close Menu",
    followSpeaker: "Follow Speaker",
    unfollowSpeaker: "Unfollow Speaker",
    followLanguage: "Follow Language",
    unfollowLanguage: "Unfollow Language",
    bookmarkRecording: "Bookmark Recording",
    unbookmarkRecording: "Remove Bookmark",
    showMore: "Show More",
    showLess: "Show Less",
    contributeTranslation: "Contribute Translation",
    verifyTranslation: "Verify Translation",
    thanksForContribution: "Thanks for your contribution!",
    submitFeedback: "Submit Feedback",
    privacyPolicy: "Privacy Policy",
    termsOfService: "Terms of Service",
    cookiePolicy: "Cookie Policy",
    allRightsReserved: "All Rights Reserved",
    poweredBy: "Powered By",
    version: "Version",
    lastUpdated: "Last Updated",
    contactUs: "Contact Us",
    followUs: "Follow Us",
    description: "Description",
    details: "Details",
    attribution: "Attribution",
    license: "License",
    contributors: "Contributors",
    relatedRecordings: "Related Recordings",
    moreFromSpeaker: "More from this Speaker",
    moreFromLanguage: "More in this Language",
    moreFromRegion: "More from this Region",
    uploadProgress: "Upload Progress",
    processingRecording: "Processing Recording",
    uploadComplete: "Upload Complete",
    uploadFailed: "Upload Failed",
    recordingFailed: "Recording Failed",
    noMicrophoneAccess: "No Microphone Access",
    allowMicrophoneAccess: "Please allow microphone access",
    recordingTooShort: "Recording too short",
    recordingTooLong: "Recording too long",
    invalidFileType: "Invalid file type",
    fileTooLarge: "File too large",
    invalidFileName: "Invalid file name",
    uploadingFile: "Uploading file...",
    processingFile: "Processing file...",
    uploadingComplete: "Upload complete",
    processingComplete: "Processing complete",
    offline: "You are offline",
    online: "You are online",
    syncStatus: "Sync Status",
    syncNow: "Sync Now",
    lastSynced: "Last Synced",
    syncComplete: "Sync Complete",
    syncFailed: "Sync Failed",
    syncProgress: "Sync Progress",
    networkError: "Network Error",
    success: "Success",
    error: "Error",
    info: "Info",
    warning: "Warning",
    close: "Close",
    open: "Open",
    confirm: "Confirm",
    apply: "Apply",
    reset: "Reset",
    clear: "Clear",
    next: "Next",
    previous: "Previous",
    first: "First",
    last: "Last",
    sortBy: "Sort By",
    filterBy: "Filter By",
    date: "Date",
    alphabetical: "Alphabetical",
    duration: "Duration",
    popularity: "Popularity",
    ascending: "Ascending",
    descending: "Descending",
    all: "All",
    none: "None",
    select: "Select",
    selectAll: "Select All",
    deselectAll: "Deselect All",
    selectFile: "Select File",
    dragAndDrop: "Drag and Drop",
    or: "Or",
    and: "And",
    browse: "Browse",
    chooseFile: "Choose File",
    chooseFiles: "Choose Files",
    noFileSelected: "No file selected",
    selectedFiles: "Selected Files",
    removeFile: "Remove File",
    removeAllFiles: "Remove All Files",
    fileTooBig: "File too big",
    invalidFileFormat: "Invalid file format",
    uploadCancelled: "Upload cancelled",
    uploadPaused: "Upload paused",
    resumeUpload: "Resume Upload",
    pauseUpload: "Pause Upload",
    cancelUpload: "Cancel Upload",
    readMore: "Read More",
    readLess: "Read Less",
    seeAll: "See All",
    seeLess: "See Less",
    viewDetails: "View Details",
    hideDetails: "Hide Details",
    showDetails: "Show Details",
    addNew: "Add New",
    create: "Create",
    update: "Update",
    recordNewVoice: "Record New Voice",
    browseArchive: "Browse Archive",
    translateRecording: "Translate Recording",
    exploreArchive: "Explore Archive",
    startTranslating: "Start Translating",
    uploadFiles: "Upload Files",
    whatWouldYouLikeToDo: "What Would You Like To Do?",
    title: "Title",
    required: "Required",
    languageName: "Language Name",
    enterLanguageName: "Enter Language Name",
    recordSentence: "Record a Phrase, Story, or Song",
    discard: "Discard",
    resume: "Resume",
    saveYourRecording: "Save Your Recording",
    speakerName: "Speaker Name",
    startOver: "Start Over",
    recordingNotFound: "Recording not found",
    titleRequired: "Title is required",
    languageRequired: "Language is required",
    startRecording: "Start Recording",
    // Added missing translations
    dangerZone: "Danger Zone",
    deleteAccount: "Delete Account",
    confirmDeletion: "Confirm Deletion",
    deleteAccountWarning: "This action cannot be undone. All your data will be permanently deleted.",
    noDevicesLinked: "No devices linked",
    linkedDevices: "Linked Devices",
    receiveEmailNotifications: "Receive email notifications",
    updatePassword: "Update Password",
    currentPassword: "Current Password",
    newPassword: "New Password",
    confirmPassword: "Confirm Password",
    updateProfile: "Update Profile",
    displayName: "Display Name",
    selectLanguage: "Select Language",
    languagePreference: "Language Preference"
  },
  hi: {
    signIn: "साइन इन करें",
    signOut: "साइन आउट करें",
    signUp: "साइन अप करें",
    email: "ईमेल",
    password: "पासवर्ड",
    confirmPassword: "पासवर्ड की पुष्टि करें",
    forgotPassword: "पासवर्ड भूल गए?",
    resetPassword: "पासवर्ड रीसेट करें",
    sendResetLink: "रीसेट लिंक भेजें",
    register: "रजिस्टर करें",
    login: "लॉग इन",
    logout: "लॉग आउट",
    whatToCallYou: "हम आपको क्या कहकर पुकारें?",
    yourName: "आपका नाम",
    welcomeBack: "वापसी पर स्वागत है",
    loginToContinue: "जारी रखने के लिए लॉग इन करें",
    createAccount: "खाता बनाएं",
    joinAWAaz: "स्वदेशी भाषाओं को संरक्षित करने में मदद करने के लिए AWAaz में शामिल हों",
    loggingIn: "लॉग इन हो रहा है...",
    creating: "खाता बना रहे हैं...",
    wrongCredentials: "गलत ईमेल या पासवर्ड",
    userExists: "इस ईमेल के साथ उपयोगकर्ता पहले से मौजूद है",
    welcome: "AWAaz में आपका स्वागत है",
    record: "रिकॉर्ड करें",
    translate: "अनुवाद करें",
    archive: "संग्रह",
    settings: "सेटिंग्स",
    about: "हमारे बारे में",
    profile: "प्रोफ़ाइल",
    language: "भाषा",
    changeLanguage: "भाषा बदलें",
    english: "अंग्रेज़ी",
    hindi: "हिन्दी",
    theme: "थीम",
    changeTheme: "थीम बदलें",
    light: "लाइट",
    dark: "डार्क",
    system: "सिस्टम",
    save: "सहेजें",
    cancel: "रद्द करें",
    home: "होम",
    search: "खोज",
    notifications: "सूचनाएँ",
    help: "सहायता",
    contact: "संपर्क",
    myRecordings: "मेरी रिकॉर्डिंग",
    allRecordings: "सभी रिकॉर्डिंग",
    followedRecordings: "फॉलो की गई रिकॉर्डिंग",
    recentRecordings: "हाल की रिकॉर्डिंग",
    popularRecordings: "लोकप्रिय रिकॉर्डिंग",
    noRecordings: "कोई रिकॉर्डिंग नहीं मिली",
    loading: "लोड हो रहा है...",
    uploadRecording: "रिकॉर्डिंग अपलोड करें",
    recordAudio: "ऑडियो रिकॉर्ड करें",
    playback: "प्लेबैक",
    pause: "रोकें",
    stop: "बंद करें",
    retry: "पुनः प्रयास करें",
    submit: "सबमिट करें",
    recordingDuration: "रिकॉर्डिंग अवधि",
    recordingDate: "रिकॉर्डिंग तिथि",
    recordingLanguage: "रिकॉर्डिंग भाषा",
    recordingSpeaker: "वक्ता",
    recordingRegion: "क्षेत्र",
    recordingType: "रिकॉर्डिंग प्रकार",
    word: "वाक्यांश",
    story: "कहानी",
    song: "गीत",
    originalLanguage: "मूल भाषा",
    translateTo: "अनुवाद करें",
    comment: "टिप्पणी",
    comments: "टिप्पणियाँ",
    addComment: "टिप्पणी जोड़ें",
    reply: "जवाब दें",
    share: "शेयर करें",
    download: "डाउनलोड करें",
    edit: "संपादित करें",
    delete: "हटाएं",
    reportIssue: "समस्या रिपोर्ट करें",
    noResults: "कोई परिणाम नहीं मिला",
    tryAgain: "फिर से प्रयास करें",
    somethingWentWrong: "कुछ गलत हो गया",
    pageNotFound: "पृष्ठ नहीं मिला",
    goBack: "वापस जाएँ",
    goToHomePage: "होम पेज पर जाएँ",
    moreInfo: "अधिक जानकारी",
    lessInfo: "कम जानकारी",
    openMenu: "मेनू खोलें",
    closeMenu: "मेनू बंद करें",
    followSpeaker: "वक्ता का फॉलो करें",
    unfollowSpeaker: "वक्ता का फॉलो हटाएं",
    followLanguage: "भाषा का फॉलो करें",
    unfollowLanguage: "भाषा का फॉलो हटाएं",
    bookmarkRecording: "रिकॉर्डिंग बुकमार्क करें",
    unbookmarkRecording: "बुकमार्क हटाएं",
    showMore: "और दिखाएं",
    showLess: "कम दिखाएं",
    contributeTranslation: "अनुवाद में योगदान दें",
    verifyTranslation: "अनुवाद सत्यापित करें",
    thanksForContribution: "आपके योगदान के लिए धन्यवाद!",
    submitFeedback: "प्रतिक्रिया सबमिट करें",
    privacyPolicy: "प्राइवेसी पॉलिसी",
    termsOfService: "सेवा की शर्तें",
    cookiePolicy: "कुकी नीति",
    allRightsReserved: "सर्वाधिकार सुरक्षित",
    poweredBy: "द्वारा संचालित",
    version: "संस्करण",
    lastUpdated: "अंतिम अपडेट",
    contactUs: "हमसे संपर्क करें",
    followUs: "हमें फॉलो करें",
    description: "विवरण",
    details: "विवरण",
    attribution: "श्रेय",
    license: "लाइसेंस",
    contributors: "योगदानकर्ता",
    relatedRecordings: "संबंधित रिकॉर्डिंग",
    moreFromSpeaker: "इस वक्ता से अधिक",
    moreFromLanguage: "इस भाषा में अधिक",
    moreFromRegion: "इस क्षेत्र से अधिक",
    uploadProgress: "अपलोड प्रगति",
    processingRecording: "रिकॉर्डिंग प्रोसेसिंग",
    uploadComplete: "अपलोड पूर्ण",
    uploadFailed: "अपलोड विफल",
    recordingFailed: "रिकॉर्डिंग विफल",
    noMicrophoneAccess: "माइक्रोफोन एक्सेस नहीं है",
    allowMicrophoneAccess: "कृपया माइक्रोफोन एक्सेस की अनुमति दें",
    recordingTooShort: "रिकॉर्डिंग बहुत छोटी है",
    recordingTooLong: "रिकॉर्डिंग बहुत लंबी है",
    invalidFileType: "अमान्य फ़ाइल प्रकार",
    fileTooLarge: "फ़ाइल बहुत बड़ी है",
    invalidFileName: "अमान्य फ़ाइल नाम",
    uploadingFile: "फ़ाइल अपलोड हो रही है...",
    processingFile: "फ़ाइल प्रोसेस हो रही है...",
    uploadingComplete: "अपलोड पूर्ण",
    processingComplete: "प्रोसेसिंग पूर्ण",
    offline: "आप ऑफलाइन हैं",
    online: "आप ऑनलाइन हैं",
    syncStatus: "सिंक स्थिति",
    syncNow: "अभी सिंक करें",
    lastSynced: "अंतिम सिंक",
    syncComplete: "सिंक पूर्ण",
    syncFailed: "सिंक विफल",
    syncProgress: "सिंक प्रगति",
    networkError: "नेटवर्क त्रुटि",
    success: "सफलता",
    error: "त्रुटि",
    info: "जानकारी",
    warning: "चेतावनी",
    close: "बंद करें",
    open: "खोलें",
    confirm: "पुष्टि करें",
    apply: "लागू करें",
    reset: "रीसेट करें",
    clear: "साफ़ करें",
    next: "अगला",
    previous: "पिछला",
    first: "पहला",
    last: "अंतिम",
    sortBy: "इसके अनुसार क्रमबद्ध करें",
    filterBy: "इसके अनुसार फ़िल्टर करें",
    date: "तारीख",
    alphabetical: "वर्णमाला क्रम",
    duration: "अवधि",
    popularity: "लोकप्रियता",
    ascending: "आरोही क्रम",
    descending: "अवरोही क्रम",
    all: "सभी",
    none: "कोई नहीं",
    select: "चुनें",
    selectAll: "सभी चुनें",
    deselectAll: "सभी अचयनित करें",
    selectFile: "फ़ाइल चुनें",
    dragAndDrop: "खींचें और छोड़ें",
    or: "या",
    and: "और",
    browse: "ब्राउज़ करें",
    chooseFile: "फ़ाइल चुनें",
    chooseFiles: "फ़ाइलें चुनें",
    noFileSelected: "कोई फ़ाइल नहीं चुनी गई",
    selectedFiles: "चुनी गई फ़ाइलें",
    removeFile: "फ़ाइल हटाएं",
    removeAllFiles: "सभी फ़ाइलें हटाएं",
    fileTooBig: "फ़ाइल बहुत बड़ी है",
    invalidFileFormat: "अमान्य फ़ाइल प्रारूप",
    uploadCancelled: "अपलोड रद्द",
    uploadPaused: "अपलोड रुका हुआ",
    resumeUpload: "अपलोड फिर से शुरू करें",
    pauseUpload: "अपलोड रोकें",
    cancelUpload: "अपलोड रद्द करें",
    readMore: "और पढ़ें",
    readLess: "कम पढ़ें",
    seeAll: "सभी देखें",
    seeLess: "कम देखें",
    viewDetails: "विवरण देखें",
    hideDetails: "विवरण छिपाएं",
    showDetails: "विवरण दिखाएं",
    addNew: "नया जोड़ें",
    create: "बनाएं",
    update: "अपडेट करें",
    recordNewVoice: "नई आवाज़ रिकॉर्ड करें",
    browseArchive: "संग्रह ब्राउज़ करें",
    translateRecording: "रिकॉर्डिंग का अनुवाद करें",
    exploreArchive: "संग्रह का अन्वेषण करें",
    startTranslating: "अनुवाद शुरू करें",
    uploadFiles: "फ़ाइलें अपलोड करें",
    whatWouldYouLikeToDo: "आप क्या करना चाहेंगे?",
    title: "शीर्षक",
    required: "आवश्यक",
    languageName: "भाषा का नाम",
    enterLanguageName: "भाषा का नाम दर्ज करें",
    recordSentence: "वाक्यांश, कहानी, या गीत रिकॉर्ड करें",
    discard: "रद्द करें",
    resume: "फिर से शुरू करें",
    saveYourRecording: "अपनी रिकॉर्डिंग सहेजें",
    speakerName: "वक्ता का नाम",
    startOver: "फिर से शुरू करें",
    recordingNotFound: "रिकॉर्डिंग नहीं मिली",
    titleRequired: "शीर्षक आवश्यक है",
    languageRequired: "भाषा आवश्यक है",
    startRecording: "रिकॉर्डिंग शुरू करें",
    // Added missing translations
    dangerZone: "खतरनाक क्षेत्र",
    deleteAccount: "खाता हटाएं",
    confirmDeletion: "हटाने की पुष्टि करें",
    deleteAccountWarning: "यह क्रिया पूर्ववत नहीं की जा सकती। आपका सभी डेटा स्थायी रूप से हटा दिया जाएगा।",
    noDevicesLinked: "कोई डिवाइस लिंक नहीं किया गया",
    linkedDevices: "लिंक किए गए डिवाइस",
    receiveEmailNotifications: "ईमेल अधिसूचनाएँ प्राप्त करें",
    updatePassword: "पासवर्ड अपडेट करें",
    currentPassword: "वर्तमान पासवर्ड",
    newPassword: "नया पासवर्ड",
    updateProfile: "प्रोफ़ाइल अपडेट करें",
    displayName: "प्रदर्शित नाम",
    selectLanguage: "भाषा चुनें",
    languagePreference: "भाषा वरीयता"
  }
};

export const TranslationProvider: React.FC<{
  children: React.ReactNode;
}> = ({ children }) => {
  const [currentLanguage, setCurrentLanguage] = useState<string>("en");

  // Initialize language from localStorage, if available
  useEffect(() => {
    const savedLanguage = localStorage.getItem("language");
    if (savedLanguage && translations[savedLanguage]) {
      setCurrentLanguage(savedLanguage);
    }
  }, []);

  // Save language preference to localStorage
  useEffect(() => {
    localStorage.setItem("language", currentLanguage);
    
    // Set the appropriate lang attribute on the html element
    document.documentElement.setAttribute("lang", currentLanguage);
    
    // Add a data-language attribute to allow for CSS targeting
    document.documentElement.setAttribute("data-language", currentLanguage);
  }, [currentLanguage]);

  const t = (key: string): string => {
    if (!key) return "";
    
    // If key exists in current language, return it
    if (
      translations[currentLanguage] &&
      translations[currentLanguage][key]
    ) {
      return translations[currentLanguage][key];
    }
    
    // Fallback to English
    if (translations["en"] && translations["en"][key]) {
      return translations["en"][key];
    }
    
    // If all else fails, return the key
    return key;
  };

  const changeLanguage = (lang: string) => {
    if (translations[lang]) {
      setCurrentLanguage(lang);
    }
  };

  // Provide both methods for backward compatibility
  return (
    <TranslationContext.Provider
      value={{
        t,
        changeLanguage,
        currentLanguage,
        setLanguage: changeLanguage // Alias for changeLanguage
      }}
    >
      {children}
    </TranslationContext.Provider>
  );
};

export const useTranslation = () => useContext(TranslationContext);
